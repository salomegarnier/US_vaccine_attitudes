---
title: "US Attitudes Towards the Covid-19 Vaccine"
author: "Salomé Garnier, Simone Lewis, Neha Gupta, Corbin Duncan, Connor Brown"
date: "4/9/2021"
output: html_document
---
# COVID-19 Vaccine Attitudes in the United States
  The novel coronavirus leading to COVID-19 infection is regarded on measures of mortality, economic ruin and transmissibility, to be the most severe pandemic in over a century. Dr. Anthony Fauci, the United States’ leading infectious disease expert and White House advisor, has outlined vaccine uptake and acceptance will be critical to any return to ‘normal’ pre-pandemic life. At the time of writing, there have been 140 million recorded cases of the infectious disease, 80 million recovered cases and 3.01 million fatalities. 

The public health response to the COVID-19 pandemic across the United States has been uncoordinated across state lines. Public cooperation with public health guidelines and restrictions has also varied greatly across the country and appears to be correlated with partisanship. Early scholarship suggests the infection has a disproportionately high infection rate among poor Americans. Manely and Shrestha (2021) find supportive evidence for counties with higher rates of poverty being less responsive to stay-at-home orders and having a higher infection rate, even in low-density locations. Some experts also expect there will be discernible variations in vaccine uptake along ethnic and wealth cleavages. What we can deduce for the aforementioned, is that Americans’ experiences of the pandemic and their relationship to health authorities is highly heterogeneous and variable. We can further intuit that health outcomes and vaccine uptake may correlate with group identity or individual characteristics.  

In this project, we seek to predict and assign a score to the willingness of individuals to be vaccinated based on their demographic characteristics. We will test and train our model using a dataset of factors associated with acceptance of the vaccine. We will then report the efficiency statistic for this model. Our group will then seek to use the polling methods of weighted sample averages, based off of the same dataset, to predict level of vaccine acceptance within regions of the United States using aggregate census data. Since the vaccine is still in restricted rollouts for many parts of the country, data on vaccine uptake rate is not readily available. Our group will, instead, seek to make cursory comparisons between predicted vaccine acceptance and compliance with public health restrictions in regions in the United States. Finally, we will consider the limits of our model.

# Data

To answer the question of whether sociodemographic factors can be determinative in predicting vaccine acceptance, we manipulate the dataset ‘The factors determining the preference for COVID-19 Vaccine,’ collected by Mondal and Sinharoy (2021) of Penn State College of Medicine Department of Pediatrics and published by Mendeley Data. The survey was conducted over the period of  May 2020 to January 2021, with an binary indicator variable distinguishing between responses before and after the first successful vaccine announcement on November 1st, 2020. The number of eligible participants, regarded by the researchers as participants who completed all survey sections and resided within the U.S, numbered 2,978.

Two continuous variables in the data were constructed by the authors. Firstly, the researchers calculated a measure of perceived threat for each respondent based, not solely on participant input, but on the age and chances of severe infection for a respondent, whether they are a healthcare worker and the severity of outbreak in a participant’s area. Secondly, the researchers consolidated responses gauging first-hand and secondary knowledge of the virus into a single measure. Respondents were asked 71 questions, seeking to record an individual’s pandemic-related stress, efforts to prevent disease spread, support for public health measures, factual knowledge of the infection, trust in local hospital efficacy and hope for the future. These responses were recorded alongside individual characteristics such as age, race, education level, family income, gender, U.S region, healthcare worker status, and healthcare access.

With 2,978 respondents, our dataset achieves a diversity in responses which will improve the predictive power of our model. Of these respondents, 28.7% report having at least one family member infected by COVID-19, 18.3% report being a healthcare worker, and 81.1% report a willingness to accept a coronavirus vaccine. In terms of race, white respondents are over represented, but we record a value above 4% for each racial identity included.

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

#load packages
library(knitr)
library(tidyverse)
library(pROC)
library(glmnet)
library(readr)
library(ggplot2)
library(jtools)

#load dataset
demographics <- read_csv("demographics_id.csv")
vaccine_data <- read.csv("vaccine_data.csv")


summarystat <-do.call(data.frame,
list("Family member infected" = mean(vaccine_data$family_member_covid, na.rm=TRUE),
"Is healthcare worker" = mean(vaccine_data$healthcare_worker, na.rm=TRUE),
"Vaccine acceptance" =  mean(vaccine_data$covid_vaccine, na.rm=TRUE)
    ))

knitr::kable(summarystat, col.names = gsub("[.]", " ",names(summarystat)), digits = 3)

knitr::kable(prop.table(table(vaccine_data$your_race)),col.names = c("Race","Proportion"), digits = 3)

#knitr::kable(prop.table(table(vaccine_data$your_education)),col.names = c("Education","Proportion"), row.names("1, Middle school or less", "2, High School", "3, Undergraduate", "4, Graduate" "5, Masters"), digits = 3)

```


# Modeling Methodology & Results

  To build the model of vaccine hesitancy, we first begun by splitting the cleaned survey data into training and testing data. Splitting of the dataset will prevent overfitting of the model through allowing the prediction value from becoming too aligned to the entire set of observations. Using random sampling, we decided to allocate 75% of the data (N = 2233) towards the training data for model building, and the remaining 25% (N = 745) for testing the accuracy and efficiency statistics of our model’s predictions of vaccine hesitancy. We decided to use an ordinal multivariable logistic regression to predict the outcome variable (Y) of vaccine willingness or hesitancy. The outcome variable, “covid_vaccine,” is coded as 1 for someone who answered on the survey, they would receive the vaccine when offered, and 0 for an observation that would refuse uptake. We fitted the first model of COVID-19 vaccine willingness with the predictor variables of gender (“gender”), age group (“age_group”), education level (“education”), race (“race”), and household income level (“financial_status”). The second model also included whether the participants had received the flu shot within the last 3 years from taking this survey. We then reported the results from both models 1 and 2. 

```{r test and train, echo = FALSE}
#split demographics voter data into training and test set using sampling
#Set seed for replication
set.seed(02138)

## For Regression analysis
#allocated 75% of data to training and 25% of data to testing
row.number <- sample(1:nrow(demographics), 0.75 * nrow(demographics))
n_train = demographics[row.number,]
n_test = demographics[-row.number,]

#summarise
paste("Dimensions of training dataset")
dim(n_train)
paste("Dimensions of testing dataset")
dim(n_test)
```
  Starting with model 1, from the sampled training data, every predictor variable was significant from at least the p < 0.05 level, the strongest predictors were education level (p = 7.23e-6) and being Black (p = 0.000135). Education had a positive relationship, where level of education rose with willingness to receive the COVID-19 vaccine, being Black had a negative relationship where they were less likely to accept the vaccine of all racial groups. All other races exhibited some negative willingness to receive the vaccine, but none near the magnitude and significance of Black respondents. Financial status was also a strong predictor (p = 0.002418) and had a positive coefficient showing that as income levels increased, so did willingness to receive the vaccine. Gender also showed that being male had a positive association with wanting to receive the vaccine. 
  
### Model 1: Excluding flu shot
 
```{r fit model 1, echo=FALSE}
## USA Model
#fit the demographic variables onto the outcome variable of vaccine acceptance

#exclude flu_shot
fm1 <- covid_vaccine ~ gender + age_group + education + race + financial_status 

#estimate model 1 (logistic regression)
model1 <- glm(fm1, data = n_train, family = "binomial", na.action = na.exclude)
summary(model1)

``` 

### Model 2: Including flu shot

```{r fit model 2, echo=FALSE}

#include flu shot
fm2 <- covid_vaccine ~ gender + age_group + education + race + financial_status + flu_shot

#estimate model 2 (logistic regression)
model2 <- glm(fm2, data = n_train, family = "binomial", na.action = na.exclude)
summary(model2)

```

**Collinearity of flu shot and Covid-19 vaccine:**
``` {r col, echo = FALSE}
#report collinearity of vaccines
cor(demographics$covid_vaccine, demographics$flu_shot, use = "complete.obs")
```



  An interesting observation we noted was found when running the second model including flu shot uptake, it had by far the most significant p-value of all indicators in both models (p = 2.25 x 10-7) and the strongest coefficient estimate. Flu shot uptake also had strong collinearity (r = 0.326) with COVID vaccine willingness, as a result, all other demographic predictors lost or had reduced significance relative to model 1. This will again be discussed further in the policy proposal, but it likely indicates that COVID vaccine willingness is heavily predicted by overall individual sentiment to the pharmaceutical and vaccine industry in general, rather than the COVID vaccine’s lack of field research and development relative to other inoculations with greater mainstream prevalence (Hopkins, 2020). As the flu shot skewed the significance of demographic variables predictive power, we decided to proceed with testing the efficiency of model 1 to isolate what demographics need greater targeting to increase their trust in the vaccine. 
  We then decided to create a prediction of vaccine willingness using model 1 and the remaining test data, “yhat_test,” the density plot outlined below shows that the average willingness prediction trended to a 0.82 chance to receive the vaccine. 

```{r prediction outcomes, echo=FALSE}
##Calculate prediction value on the test set
yhat_test<- predict(model1, newdata = n_test, "response")

#Plot prediction value density of test set
hist(yhat_test, freq = FALSE, xlim = c(0, 1), ylim = c(0, 6))

```

**Mean of yhat:**
```{r yhat, echo=FALSE}
#Create yhat column on the country level model
demographics$yhat <- as.numeric(predict(model1, newdata = demographics, "response"))

mean(demographics$yhat, na.rm = TRUE)
```
  After creating our predictor variable from the test data, we then plotted a receiver operating characteristic (ROC) curve for vaccine willingness model outlined below.

```{r roc curve, echo=FALSE, message=FALSE}
#Compute ROC curve 
dem.roc1 <- roc(
  response  = n_test$covid_vaccine,
  predictor = yhat_test
)

#Plot ROC curve
plot(dem.roc1, 
     xlab = "False Positive Rate or 1-Specificity",
     ylab = "True Positive Rate or Sensitivity",
     main = "ROC Curve (Our Model)",
     legacy.axes = TRUE)

#Calculate AUC = 0.703, chance a positive case outranks a negative case. 
auc(dem.roc1)

```  
  The ROC curve visually represents the probability that a true positive case (sensitivity) outranks a false positive error (1 – specificity), we computed an area under curve (AUC) value of 0.703, indicating an above 70% chance that a true positive case will occur relative to a false positive. This would position our model in the acceptable discrimination range (Hosmer & Lemeshow, 2013), where any value below 0.5 would suggest no discrimination between positive and negative cases, no better than random chance. 
	Using the results from the ROC curve, we then calculated the threshold to classify an observation inserted into model 1 as a positive case of wanting to receive the COVID-19 vaccine. Utilising best weights, we computed a threshold value of 0.827 to classify an observation as a positive case. 

```{r threshold and model accuracy, echo=FALSE}
#Calculate the threshold for positive case from test set
threshold <- coords(dem.roc1, x = "best", transpose = TRUE,
                      ret = c("threshold","accuracy","precision","recall"))

#Report efficiency table of model
knitr::kable(rbind(threshold), row.names = FALSE, digits = 3)

```

**f-score:**
```{r f-score, echo=FALSE}
n_test$threshold <- threshold[1]

#Calculate f-score 
f1 <- 2*((0.91*0.617)/(0.91+0.617))
f1
```

**Model Efficiency**

```{r model efficiency, echo=FALSE}
#Use boolean logic to determine model v. actual prediction value
n_test$yhat_actual <- as.numeric(yhat_test >= n_test$threshold)

#Create prop table of model efficiency
prop_table_covid <- prop.table(table(n_test$yhat_actual, n_test$covid_vaccine))
rownames(prop_table_covid) <- c("Deny Vaccine (Predicted)", "Seek Vaccine (Predicted)")
colnames(prop_table_covid) <- c("Deny Vaccine (True)", "Seek Vaccine (True)")
prop_table_covid

##False negative rate is 0.312 (top right), the false positive rate is 0.0496 (bottom left)
```

  An efficiency table of this calculation showed that our model had an accuracy, the proportion of correct predictions, at 0.639, its precision, the percentage of relevant results, at 0.91, and recall, the percentage relevant results that are correctly classified by the model at 0.617. We computed the F1-score, a truer measure of accuracy accounting for precision and recall, giving more weight to false negatives and false positives while not letting large numbers of true negatives influence the score, this result came to 0.735. Finally, we produced a 2x2 table to summarise the true positivity and negativity rate, as well as the false positivity and negativity rate which aligned with the efficiency statistics above. 
	From a public policy perspective, the true aim of our model is to accurately predict which demographics are hesitant to receive the COVID vaccine, and then employ effective targeting of these groups to allay risks of seeking inoculation to hasten the end of the pandemic and reach herd immunity. This is especially true for minority groups and those from lower socio-economic backgrounds, who are more likely to experience more severe consequences from contracting the virus due to greater prevalence of comorbid conditions relative to white, and wealthier groups (Obermeyer et. al, 2019). In this case, the F1-score is especially important as it weighs false positives, an observation that we predict will seek the vaccine, but will actually deny the vaccine in reality, more heavily. These are cases that our model must necessarily avoid at all costs, as it would result in groups not receiving sufficient targeting to receive the vaccine due to predicting they would in reality this is not the case. Our false positivity rate was below 5% (0.0496) showing that these vulnerable groups are in most cases being captured by the model, and is reflected in the robustness of the model’s F1-score. 
	
	
# Discussing and Visualizing the Results
	
Overall, being white, older, richer, and more educated	were strong predictors of acceptance of the vaccine.

EXPLAIN EACH FACTOR (SUCCINTLY) UNDER EACH GRAPH

	
```{r age, echo=FALSE}

# Effect of age
effect_plot(model1, pred = age_group, colors = "#7C72A0") +
         theme_classic() +
         labs(title = "Vaccine Acceptance and Age",
              subtitle = "Predicted change in acceptance of the Covid-19 vaccine by age group",
              x = "Age",
              y = "Acceptance of Vaccine") + 
           theme(plot.title = element_text(face = "bold",
                                         size = 18),
               plot.subtitle = element_text(size = 13),
               axis.text.x = element_text(size = 13), 
               axis.text.y = element_text(size = 13),
               axis.title.x = element_text(size = 16, 
                                           margin = margin(t = 20)),
               axis.title.y = element_text(size = 16, 
                                           margin = margin(r = 15))) +
         scale_x_continuous(breaks = c(1, 2, 3, 4, 5), 
                            labels = c("18-24", "25-44", "45-60", "61-70", ">70"))+
  ylim(0.87, 0.95)
```

We observe a positive and strong relationship between age and greater COVID-19 vaccine acceptance.The most obvious reasoning behind this observation is the parallel relationship between age and the risk of severe illness from COVID-19. Older individuals face a greater risk of hospitilation and death from the virus and 8 out of 10 COVID-19 deaths reported in the U.S. have been among those 65 and older ^[https://www.cdc.gov/coronavirus/2019-ncov/need-extra-precautions/older-adults.html]. Difference in the level of risk of COVID-19 reflects the variability of vaccine acceptance among age groups with older adults having greater incentives to take the vaccine. 


```{r financial, echo = FALSE, warning=FALSE}
#Effect of financial status
effect_plot(model1, pred = financial_status, colors = "#545643") +
         theme_classic() +
         labs(title = "Vaccine Acceptance and Financial Status",
              subtitle = "Predicted change in acceptance of the Covid-19 vaccine by financial status",
              x = "Financial Status",
              y = "Acceptance of Vaccine") + 
           theme(plot.title = element_text(face = "bold",
                                         size = 18),
               plot.subtitle = element_text(size = 13),
               axis.text.x = element_text(size = 13), 
               axis.text.y = element_text(size = 13),
               axis.title.x = element_text(size = 16, 
                                           margin = margin(t = 20)),
               axis.title.y = element_text(size = 16, 
                                           margin = margin(r = 15))) +
         scale_x_continuous(breaks = c(1, 2, 3, 4), 
                            labels = c("Lower Middle Class/Poor", "Middle Class", "Upper Middle Class", "Wealthy")) +
 ylim(0.87, 0.95)
```
We also observe a strong and positive relationship between an individual's reported financial status and their likelihood of vaccine acceptance. In the U.S.,Higher income typically allows for better access to healthcare services and greater interaction with healthcare professionals while the opposite is true lower income^[]. This connection is a potential explanation of the greater mistrust towards healthcare among those with a low income. Cost related concerns are also more prominent among low-income individuals and an additional factor that can promote vaccine hesitance. Notably, a recent Census survey revealed that nearly 7 million Americans were unaware the the COVID vaccine was free ^[https://fortune.com/2021/03/10/covid-vaccine-free-people-not-getting-coronavirus-vaccines-cost-price/].


```{r education, echo=FALSE}
# Effect of education
effect_plot(model1, pred = education, colors = "#E8998D") +
         theme_classic() +
         labs(title = "Vaccine Acceptance and Education",
              subtitle = "Predicted change in acceptance of the Covid-19 vaccine by education level",
              x = "Education Level",
              y = "Acceptance of Vaccine") + 
           theme(plot.title = element_text(face = "bold",
                                         size = 18),
               plot.subtitle = element_text(size = 13),
               axis.text.x = element_text(size = 13), 
               axis.text.y = element_text(size = 13),
               axis.title.x = element_text(size = 16, 
                                           margin = margin(t = 20)),
               axis.title.y = element_text(size = 16, 
                                           margin = margin(r = 15))) +
         scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7), 
                            labels = c("Middle School", "High School", "Undergraduate", "Graduate", "Masters", "Doctorate", "Professional")) +
ylim(0.87, 0.95)
```
Given the strong correlation between education and financial status, there is a lot of overlap in the mechanisms that help explain why COVID-19 vaccine acceptance varies along these dimensions. For instance, lower education is also associated with lower interaction with healthcare professionals and a related lower level of trust. Additionally, education is closely related to awareness about the details of vaccines and general health literacy^[Khubchandani, Jagdish et al. “COVID-19 Vaccination Hesitancy in the United States: A Rapid National Assessment.” Journal of community health vol. 46,2 (2021): 270-277].

```{r race, echo=FALSE}
# Effect of race
effect_plot(model1, pred = race, colors = "#627C85") +
         theme_classic() +
         labs(title = "Vaccine Acceptance and Race",
              subtitle = "Predicted change in acceptance of the Covid-19 vaccine by race",
              x = "Race",
              y = "Acceptance of Vaccine") + 
           theme(plot.title = element_text(face = "bold",
                                         size = 18),
               plot.subtitle = element_text(size = 13),
               axis.text.x = element_text(size = 13), 
               axis.text.y = element_text(size = 13),
               axis.title.x = element_text(size = 16, 
                                           margin = margin(t = 20)),
               axis.title.y = element_text(size = 16, 
                                           margin = margin(r = 15))) 
```


DISCUSSION OF RACE AND VACCINE HESITANCY

From Connor's text (about low levels of trust from black people, can probably add to this section): This will be discussed further in the policy proposal section, but this can likely be explained by the fact that health professionals hold differential perceptions of Black patients, particularly intelligence and pain tolerance which would potentially reduce the rates in which non-Black doctors admit Black patients for healthcare interventions. When Black patients are assigned to a physician, there is higher uptake of recommended care when the provider was Black. Overall, these exhibited racial biases on the part of human error and prejudice demonstrate the significantly reduced trust Black individuals have in the healthcare system (Obermeyer et. al, 2019). 

```{r gender, echo=FALSE}
# Effect of gender
effect_plot(model1, pred = gender, colors = "#DB6C79") +
         theme_classic() +
         labs(title = "Vaccine Hesitancy and Gender",
              subtitle = "Predicted change in acceptance of the Covid-19 vaccine by gender",
              x = "Gender",
              y = "Acceptance of Vaccine") + 
           theme(plot.title = element_text(face = "bold",
                                         size = 18),
               plot.subtitle = element_text(size = 13),
               axis.text.x = element_text(size = 13), 
               axis.text.y = element_text(size = 13),
               axis.title.x = element_text(size = 16, 
                                           margin = margin(t = 20)),
               axis.title.y = element_text(size = 16, 
                                           margin = margin(r = 15))) 

```
Although the predicted vaccine acceptance among men is slightly higher than for women, the confidence intervals for these estimates overlap and we cannot say for certain that there is a relationship between gender and COVID vaccine acceptance. 

# Vaccine acceptance and public health responsiveness 

```{r public health roc curve, echo=FALSE, message=FALSE}
#Establish measure of public health responsiveness
#n_test$resistph <- as.numeric(resistph=1 if n_test$LD >= 4 & n_test$FM >= 4 | n_test$LD >= 4 & n_test$reopening =< 2 | n_test$reopening =< 2 & n_test$FM >= 4)

## I need LD, FM and reopening included in n_test.

#Compute ROC curve 
dem.roc2 <- roc(
  response  = n_test$resistph,
  predictor = yhat_test
)

#Plot ROC curve
plot(dem.roc2, 
     xlab = "False Positive Rate or 1-Specificity",
     ylab = "True Positive Rate or Sensitivity",
     main = "ROC Curve (Our Model) for Anti-Public Health restrictions",
     legacy.axes = TRUE)

#Calculate AUC
auc(dem.roc2)

```

```{r threshold and model accuracy, echo=FALSE}
#Calculate the threshold for positive case from test set
threshold_rph <- coords(dem.roc2, x = "best", transpose = TRUE,
                      ret = c("threshold","accuracy","precision","recall"))

#Report efficiency table of model
knitr::kable(rbind(threshold_rph), row.names = FALSE, digits = 3)

```

```{r model efficiency, echo=FALSE}
#Use boolean logic to determine model v. actual prediction value
n_test$yhat_rphpredict <- as.numeric(yhat_test >= n_test$threshold_rph)

#Create prop table of model efficiency
prop_table_covid <- prop.table(table(n_test$yhat_rphpredict, n_test$resistph))
rownames(prop_table_covid) <- c("Anti-Public Health Measures (Predicted)", "Responsive to PH Measures (Predicted)")
colnames(prop_table_covid) <- c("Anti-Public Health Measures (True)", "Responsive to PH Measures (True)")
prop_table_covid

```


``` 
```
## Works Cited:
  Hopkins, J. (2020). A Covid-19 Vaccine Problem: People Who Are Afraid to Get One. Wall Street Journal. 
  Hosmer Jr, D. W., Lemeshow, S., & Sturdivant, R. X. (2013). Applied logistic regression (Vol. 398). John Wiley & Sons.
  Obermeyer, Z., Powers, B., Vogeli, C., & Mullainathan, S. (2019). Dissecting racial bias in an algorithm used to manage the health of populations. Science, 366(6464), 447-453.


DATA: https://data.mendeley.com/datasets/kbzskd37zy/3
