---
title: "Modeling"
author: "Salom√© Garnier, Simone Lewis, Neha Gupta, Corbin Duncan, Connor Brown"
date: "4/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#load packages
library(tidyverse)
library(pROC)
library(glmnet)
library(readr)

#load dataset
demographics <- read_csv("demographics_id.csv")
```

Connor: I went back into the .csv and added an id column (I'll upload to Git) which allowed me to split using random sampling between training and testing data. 

```{r test and train}
#split demographics voter data into training and test set using sampling
#Set seed for replication
set.seed(02138)

#allocated 75% of data to training
n_train  <- floor(nrow(demographics) * 0.75)

#allocated 25% of data to testing
n_test   <- nrow(demographics) - n_train 
demographics_split <- sample(c(rep(TRUE, n_train), rep(FALSE, n_test)))

#label according to id column
train_id <- demographics[demographics_split == TRUE, "id"]
test_id  <- demographics[demographics_split == FALSE,"id"]

```
Connor: Here I fitted a logistic regression model on the predictor (X) demographic variables of gender, age, education, race, and financial status. Intention to take up the covid vaccine based on the survey results is the outcome variable (Y). From looking at the model output, education level and financial status are significant at the p < 0.05 level; there is a positive relationship. Age is also slightly significant at the 0.10 level, again there is a positive relationship. 

```{r fit model}
## USA Model
#fit the demographic variables onto the outcome variable of vaccine acceptance
fm1 <- covid_vaccine ~ as.factor(gender) + age_group + education + as.factor(race) + financial_status 

#estimate model (logistic regression)
model1 <- glm(fm1, data = demographics, subset = id %in% train_id,
             family = "binomial", na.action = na.exclude)
summary(model1)

```

```{r prediction outcomes}
#Create yhat variable based on the country level model
demographics$yhat <- predict(model1, newdata = demographics, "response")

#Plot histogram of predicted value density
hist(demographics$yhat, freq = FALSE, xlim = c(0, 1), ylim = c(0, 6))

```

```{r roc curve}
#Compute ROC curve 
nc.roc1 <- roc(
  response  = demographics$covid_vaccine[demographics$id %in% test_id],
  predictor = demographics$yhat[demographics$id %in% test_id]
)

#Plot ROC curve
plot(nc.roc1, 
     xlab = "False Positive Rate or 1-Specificity",
     ylab = "True Positive Rate or Sensitivity",
     main = "ROC Curve (Our Model)",
     legacy.axes = TRUE)
```
